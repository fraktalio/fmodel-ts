"use strict";(self.webpackChunkfmodel_ts_doc=self.webpackChunkfmodel_ts_doc||[]).push([[622],{5098:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var t=r(4848),a=r(8453),s=r(1470),i=r(9365);const o={sidebar_position:5},c="Specification By Example",l={id:"domain/specification-by-example",title:"Specification By Example",description:"- It is a collaborative approach to software analysis and testing.",source:"@site/docs/domain/specification-by-example.md",sourceDirName:"domain",slug:"/domain/specification-by-example",permalink:"/fmodel-ts/docs/domain/specification-by-example",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Aggregating the Behaviour",permalink:"/fmodel-ts/docs/domain/aggregating-the-behaviour"},next:{title:"Composing The Application",permalink:"/fmodel-ts/docs/category/composing-the-application"}},d={},u=[{value:"Illustrating requirements using examples",id:"illustrating-requirements-using-examples",level:2},{value:"Refining specifications",id:"refining-specifications",level:2},{value:"Automating tests based on examples",id:"automating-tests-based-on-examples",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"specification-by-example",children:"Specification By Example"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"It is a collaborative approach to software analysis and testing."}),"\n",(0,t.jsx)(n.li,{children:"It is the fastest way to align people from different roles on what exactly we need to build and how to test it."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"illustrating-requirements-using-examples",children:"Illustrating requirements using examples"}),"\n",(0,t.jsxs)(n.p,{children:["The requirements are presented as scenarios.\nA scenario is an example of the system\u2019s behavior from the users\u2019 perspective,\nand they are specified using the ",(0,t.jsx)(n.code,{children:"Given-When-Then"})," structure to create a testable specification:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Given ",(0,t.jsx)(n.code,{children:"< some precondition(s) >"})]}),"\n",(0,t.jsxs)(n.li,{children:["When ",(0,t.jsx)(n.code,{children:"< an action/trigger occurs >"})]}),"\n",(0,t.jsxs)(n.li,{children:["Then ",(0,t.jsx)(n.code,{children:"< some post condition >"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"We face business with specific questions they should be able to answer.\nWe are not facing them with abstractions or generalizations.\nWe are dealing only with data that are formally representing preconditions (events), actions (commands) and post\nconditions (new events):"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Given ",(0,t.jsx)(n.code,{children:"< some event(s) / current state of our system > "})]}),"\n",(0,t.jsxs)(n.li,{children:["When ",(0,t.jsx)(n.code,{children:"< a command occurs >"})]}),"\n",(0,t.jsxs)(n.li,{children:["Then ",(0,t.jsx)(n.code,{children:"< some new event(s) / evolves to the new state of our system >"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"It also represents an acceptance criterion of the system, and acts as a documentation."}),"\n",(0,t.jsx)(n.h2,{id:"refining-specifications",children:"Refining specifications"}),"\n",(0,t.jsx)(n.p,{children:"Let's pivot the blueprint for 90 degrees, and refine our requirements further."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"restaurant model",src:r(7172).A+"",width:"2787",height:"1434"})}),"\n",(0,t.jsxs)(n.p,{children:["We need to go through all the scenarios, successes and errors.\nFor example, for an ",(0,t.jsx)(n.code,{children:"OrderDecider"})," with given ",(0,t.jsx)(n.code,{children:"OrderCreatedEvent"})," event as a precondition, when\ncommand ",(0,t.jsx)(n.code,{children:"MarkOrderAsPreparedCommand"})," is triggered, then Order is successfully prepared (",(0,t.jsx)(n.code,{children:"OrderPreparedEvent"}),").\nBut, without ",(0,t.jsx)(n.code,{children:"OrderCreatedEvent"})," given as precondition, handling the same command ",(0,t.jsx)(n.code,{children:"MarkOrderAsPreparedCommand"})," will\nproduce different result/failure (",(0,t.jsx)(n.code,{children:"OrderNotPreparedEvent"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"It means that order can be marked as prepared only if it was previously created/placed."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"spec image",src:r(7753).A+"",width:"2387",height:"1675"})}),"\n",(0,t.jsx)(n.h2,{id:"automating-tests-based-on-examples",children:"Automating tests based on examples"}),"\n",(0,t.jsxs)(n.p,{children:["Functions/lambda offers the algebra of manipulating the data (commands, events, state) in a compositional manner,\neffectively modeling the behavior.\nThis leads to modularity in design and a clear separation of the entity\u2019s structure and functions/behaviour of the\nentity. ",(0,t.jsx)(n.strong,{children:"It makes it easy to test!"})]}),"\n",(0,t.jsxs)(n.p,{children:["You can create a small DSL in Kotlin to write and run specifications in ",(0,t.jsx)(n.code,{children:"Given-When-Then"})," structure (testable\nspecification):"]}),"\n",(0,t.jsxs)(s.A,{groupId:"component-type",queryString:"component-type",children:[(0,t.jsx)(i.A,{value:"decider",label:"Decider",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'export const DeciderSpecification = {\n  for: <C, S, E>(decider: IDecider<C, S, E>): DeciderSpecification<C, E> => {\n    return {\n      given: (events: E[]) => {\n        return {\n          when: (command: C) => {\n            const handle = () => {\n              const currentState = events.reduce<S>(\n                decider.evolve,\n                decider.initialState\n              );\n              return decider.decide(command, currentState);\n            };\n\n            return {\n              then: (expectedEvents: E[]) => {\n                const resultEvents = handle();\n                assertEquals(resultEvents, expectedEvents);\n              },\n              thenThrows: (check?: (error: Error) => boolean) => {\n                try {\n                  handle();\n                  throw new Error("Handler did not fail as expected");\n                } catch (error) {\n                  if (check) assert(check(error as Error) === true);\n                }\n              },\n            };\n          },\n        };\n      },\n    };\n  },\n};\n'})})}),(0,t.jsx)(i.A,{value:"view",label:"View",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'export const ViewSpecification = {\n  for: <S, E>(view: IView<S, E>): ViewSpecification<S, E> => {\n    return {\n      given: (events: E[]) => {\n        const handle = () => {\n          return events.reduce<S>(view.evolve, view.initialState);\n        };\n        return {\n          then: (expectedState: S) => {\n            const resultState = handle();\n            assertEquals(resultState, expectedState);\n          },\n          thenThrows: (check?: (error: Error) => boolean) => {\n            try {\n              handle();\n              throw new Error("Handler did not fail as expected");\n            } catch (error) {\n              if (check) assert(check(error as Error) === true);\n            }\n          },\n        };\n      },\n    };\n  },\n};\n'})})})]}),"\n",(0,t.jsx)(n.p,{children:"Runnable tests:"}),"\n",(0,t.jsxs)(s.A,{groupId:"component-type",queryString:"component-type",children:[(0,t.jsx)(i.A,{value:"decider",label:"Decider",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"Deno.test(function markOrderAsPeparedDeciderTest() {\n  // Parse the order command from the request / Zod validation/parsing\n  const markOrderAsPreparedCommand: OrderCommand = orderCommandSchema\n    .parse(\n      JSON.parse(markOrderAsPreparedCommandJson),\n    );\n\n  // Parse the order event.\n  const orderCreatedEvent: OrderEvent = orderEventSchema\n    .parse(\n      JSON.parse(orderCreatedEventJson),\n    );\n  // Parse the order event.\n  const orderPreparedEvent: OrderEvent = orderEventSchema\n    .parse(\n      JSON.parse(orderPreparedEventJson),\n    );\n\n  // Run the test specification for the order decider\n  DeciderSpecification.for(orderDecider)\n    .given([orderCreatedEvent])\n    .when(markOrderAsPreparedCommand)\n    .then([orderPreparedEvent]);\n});\n"})})}),(0,t.jsx)(i.A,{value:"view",label:"View",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'\nDeno.test(function orderPreparedViewTest() {\n  // Parse the order event.\n  const orderCreatedEvent: OrderEvent = orderEventSchema\n    .parse(\n      JSON.parse(orderCreatedEventJson),\n    );\n  const orderPreparedEvent: OrderEvent = orderEventSchema\n    .parse(\n      JSON.parse(orderPreparedEventJson),\n    );\n\n  ViewSpecification.for(orderView)\n    .given([orderCreatedEvent, orderPreparedEvent])\n    .then({\n      orderId: "691490bb-c4d3-45b8-99d0-efcf20e353ag",\n      restaurantId: "691490bb-c4d3-45b8-99d0-efcf20e353ao",\n      menuItems: [\n        { menuItemId: "1", name: "Salad2", price: "18.59" },\n        { menuItemId: "2", name: "Soup2", price: "16.94" },\n        { menuItemId: "3", name: "Steak2", price: "19.89" },\n      ],\n      status: "PREPARED",\n    });\n});\n'})})})]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},9365:(e,n,r)=>{r.d(n,{A:()=>i});r(6540);var t=r(4164);const a={tabItem:"tabItem_Ymn6"};var s=r(4848);function i(e){let{children:n,hidden:r,className:i}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(a.tabItem,i),hidden:r,children:n})}},1470:(e,n,r)=>{r.d(n,{A:()=>y});var t=r(6540),a=r(4164),s=r(3104),i=r(6347),o=r(205),c=r(7485),l=r(1682),d=r(679);function u(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:r}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:r,attributes:t,default:a}}=e;return{value:n,label:r,attributes:t,default:a}}))}(r);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function p(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:r}=e;const a=(0,i.W6)(),s=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,c.aZ)(s),(0,t.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(a.location.search);n.set(s,e),a.replace({...a.location,search:n.toString()})}),[s,a])]}function f(e){const{defaultValue:n,queryString:r=!1,groupId:a}=e,s=h(e),[i,c]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=r.find((e=>e.default))??r[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:s}))),[l,u]=m({queryString:r,groupId:a}),[f,v]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,s]=(0,d.Dv)(r);return[a,(0,t.useCallback)((e=>{r&&s.set(e)}),[r,s])]}({groupId:a}),g=(()=>{const e=l??f;return p({value:e,tabValues:s})?e:null})();(0,o.A)((()=>{g&&c(g)}),[g]);return{selectedValue:i,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),v(e)}),[u,v,s]),tabValues:s}}var v=r(2303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=r(4848);function x(e){let{className:n,block:r,selectedValue:t,selectValue:i,tabValues:o}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),d=e=>{const n=e.currentTarget,r=c.indexOf(n),a=o[r].value;a!==t&&(l(n),i(a))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=c.indexOf(e.currentTarget)+1;n=c[r]??c[0];break}case"ArrowLeft":{const r=c.indexOf(e.currentTarget)-1;n=c[r]??c[c.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":r},n),children:o.map((e=>{let{value:n,label:r,attributes:s}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>c.push(e),onKeyDown:u,onClick:d,...s,className:(0,a.A)("tabs__item",g.tabItem,s?.className,{"tabs__item--active":t===n}),children:r??n},n)}))})}function j(e){let{lazy:n,children:r,selectedValue:s}=e;const i=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===s));return e?(0,t.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function w(e){const n=f(e);return(0,b.jsxs)("div",{className:(0,a.A)("tabs-container",g.tabList),children:[(0,b.jsx)(x,{...n,...e}),(0,b.jsx)(j,{...n,...e})]})}function y(e){const n=(0,v.A)();return(0,b.jsx)(w,{...e,children:u(e.children)},String(n))}},7172:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/restaurant-model-bddc3c24c98956e7e56820d50a92ee77.jpg"},7753:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/spec-by-example-53fb5df5cb1d604d6701aea1021a2c13.jpg"},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var t=r(6540);const a={},s=t.createContext(a);function i(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);